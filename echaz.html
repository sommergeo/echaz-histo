<!DOCTYPE html>
<html>
<head>
	<title>GEO-77 map</title>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
	integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
	crossorigin=""/>

	<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
	integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
	crossorigin=""></script>
	

	<style>
	html, body, #map {
		width: 100%;
		height: 100%;
		padding: 0;
		margin: 0;
	}
	</style>
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

</head>


<body>

<!--<div id="mapid" style="width: 600px; height: 400px; position: relative;"></div> -->
<div id="mapid" style="width: 100%; height: 100%; padding: 0; margin: 0;"></div>

<script src="data/geojson/ufk.js" ></script>
<script src="data/geojson/1908.js"></script>
<script src="data/geojson/1963korr.js"></script>
<script src="data/geojson/1977korr.js"></script>
<script src="data/geojson/1987korr.js"></script>
<script src="data/geojson/1999korr.js"></script>
<script src="data/geojson/1936korr.js"></script>
<script src="data/geojson/sagenweg1.js"></script>
<script src="data/geojson/Rundweg_Ursula_klein.js"></script>
<script src="data/geojson/Rundweg_Ursula_Lang.js"></script>
<script src="data/geojson/POI_demo.js"></script>
<script>

	
	// Create Leaflet map
	var mymap = L.map('mapid').setView([48.456930, 9.228969], 14);
	//var mymap = L.map('mapid').fitWorld();

	// add scale
	var legend = L.control.scale({maxWidth: 250, metric: true, imperial: true}).addTo(mymap);

	
	// Add basemaps
	// Basemap 1: OSM
	var basemap_osm = L.tileLayer('https://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png', {
		attribution: '<a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
	}).addTo(mymap);
	
	// Basemap 2: Maps4BW
	var basemap_maps4bw = L.tileLayer.wms("https://owsproxy.lgl-bw.de/owsproxy/ows/WMS_Maps4BW?", {
			layers: 'webatlasde',
			format: 'image/png',
			transparent: true,
			attribution: "LGL, www.lgl-bw.de"
		});
	//basemap_maps4bw.addTo(mymap);
    
    // Basemap 3: Oberamtsbeschreibung
    var basemap_OART = L.tileLayer.wms("http://134.2.217.5:81/cgi-bin/qgis_mapserv.fcgi?VERSION=1.3.0&Map=/projects/Oberamt/Oberamt_RT.qgs&", {
        layers: 'Oberamt_Reutlingen_Karte4_modified',
        format: 'image/png',
        transparent: 'true',
        minZoom: 0,
        maxZoom: 12,
        attribution: '<a href="https://de.wikisource.org/wiki/Beschreibung_des_Oberamts_Reutlingen#Beilagen">Wikisource</a>'
        });
    // basemap_OART.addTo(mymap);
        
    
    //STYLING
        //Wanderwege & POIs
    var mystyle_sagenweg = {
        "color": "#e41a1c",
        "weight": 7,
        "opacity": 0.6,
    };
    
    var mystyle_ursula_kurz = {
        "color": '#33a02c',
        "weight": 7,
        "opacity": 0.6,
    };
    
    var mystyle_ursula_lang = {
        "color": '#ff7f00',
        "weight": 7,
        "opacity": 0.6,
    };

    // Custom Icon for POI --> Attribution?
    function createCustomIcon (feature, latlng){
        let myIcon = L.icon ({
            iconUrl: 'https://image.flaticon.com/icons/svg/426/426958.svg',
            iconSize: [50, 40],
            iconAnchor: [12, 12],
            popupAnchor: [13, -10],
        })
        return L.marker(latlng, {icon: myIcon})
        }
    let myLayerOptions = {
        pointToLayer: createCustomIcon    
    }
    
      // Polygon Styling nach Klasse
    function getClassColor(feature){
        console.log(feature)
        switch (feature.properties.Klasse){
            case 1 : return '#2A2A2A';
            case 2 : return '#FF7F7F';
            case 3 : return '#FC3D45';
            case 4 : return '#005B0F';
            case 5 : return '#24FF84';
            case 6 : return '#6AFF24';
            case 7 : return '#986C00';
            case 8 : return '#DED402';
            case 10 : return '#02DED7';
            case 11 : return '#BD02DE';
            case 12 : return '#D8FF00';
            case 13 : return '#868686';
        }
       };
    
    function ClassStyle(feature) {
        return {
        fillColor: getClassColor(feature),
        weight: 2,
        opacity: 10,
        color: 'black',
        dashArray: '3',
        fillOpacity: 0.7
        };
    }    

// Overlays
	// Urflurkarte
	var olay_ufk = L.geoJSON(ufk, {
        style :ClassStyle,
        minZoom: 0,
        maxZoom: 12
    });
	//olay_ufk.addTo(mymap);
	var olay_ufk_raster = L.tileLayer.wms("https://owsproxy.lgl-bw.de/owsproxy/ows/WMS_LGL-BW_HIST_FKWue_25_K?user=la_bw&password=???", {
			layers: 'RDS.LY_HISTFK25_SWKOMBI',
			format: 'image/png',
			transparent: false,
			attribution: "&copy; LGL, <a href=\"http://www.lgl-bw.de\" target=\"_blank\">www.lgl-bw.de</a>",
			minZoom: 12,
            maxZoom: 20
		});
	//olay_ufk_raster.addTo(mymap);
	var lg_ufk = L.layerGroup([olay_ufk, olay_ufk_raster, basemap_OART]); 
        
	// Karten von 1908 bis 1999
    
    var olay_1908 = L.geoJSON(fk1908, {
        style: ClassStyle
    });
    //  olay_1908.addTo(mymap);
	
    var olay_1936 = L.geoJSON(fk1936korr, {
        style: ClassStyle
    });
    //olay_1936.addTo(mymap);
    
    var olay_1963 = L.geoJSON(fk1963korr,{
        style: ClassStyle
    });
    //olay_1963.addTo(mymap);
    
    var olay_1977 = L.geoJSON(fk1977korr,{
        style: ClassStyle
    });
    //olay_1977.addTo(mymap);
 
    var olay_1987 = L.geoJSON(fk1987korr, {
        style: ClassStyle
    });
    //olay_1977.addTo(mymap);
    
    var olay_1999 = L.geoJSON(fk1999korr, {
        style: ClassStyle
    });
    //olay_1999.addTo(mymap);
    
    // Style Versuch #2

    
//Overlay Wanderwege
    //Sagenweg
    var hiking_sagenweg = L.geoJSON(Hiking_Sagenweg, {
        style: mystyle_sagenweg
    });
    //hiking_sagenweg.addTo(mymap);
    
    //Wanderungen am Ursulaberg
    var hiking_ursula_rund_kurz = L.geoJSON(hiking_ursula_rund_kurz, {
        style: mystyle_ursula_kurz
    });
    //hiking_ursula_rund_kurz.addTo(mymap);
    
    var hiking_ursula_rund_lang = L.geoJSON(hiking_ursula_rund_lang, {
        style: mystyle_ursula_lang
    });
    //hiking_ursula_rund_lang.addTo(mymap);
    
//Overlay Points of Interest
    //POI Demo nur für vorläufige Screenshots
    var POI_demo = L.geoJSON(POI_demo, myLayerOptions);
    //POI_demo.addTo(mymap);
    
    // Legend
	var basemaps = {
		"Open Street Map": basemap_osm,
		"Maps4BW": basemap_maps4bw,
        "Oberamtsbeschreibung Reutlingen": basemap_OART
       };
    
		
	var overlays = {
		"1818-1840 Urflurkarte + Oberamtsbeschreibung": lg_ufk,
        "1908 Landnutzung": olay_1908,
        "1936 Landnutzung": olay_1936,
        "1963 Landnutzung": olay_1963,
        "1977 Landnutzung": olay_1977,
        "1987 Landnutzung": olay_1987,
        "1999 Landnutzung": olay_1999,
        "Sagenweg": hiking_sagenweg,
        "Ursulaberg Rundweg kurz": hiking_ursula_rund_kurz,
        "Ursulaberg Rundweg Lang": hiking_ursula_rund_lang,
        "Points of Interest": POI_demo,
       
    };
      
    
// Layer Controlls
	var legendolay = L.control.layers(basemaps, overlays,{collapsed: false}).addTo(mymap);

//Pop-Ups Vorläufig
    POI_demo.bindPopup("Das ist ein Pop-Up").openPopup();
	
	// Locate user
	mymap.locate({setView: true, maxZoom: 18});
	function onLocationFound(e) {
		var radius = e.accuracy;
		L.marker(e.latlng).addTo(mymap)
			.bindPopup("Sie sind hier").openPopup();
		L.circle(e.latlng, radius).addTo(mymap);
	}

	mymap.on('locationfound', onLocationFound);
	
</script>
	



</body>
</html>